<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.platform.mapper.CategoryMapper">

  <resultMap id="CategoryResultMap" type="com.project.platform.entity.Category">
    <id column="id" property="id"/>
    <result column="name" property="name"/>
    <result column="slug" property="slug"/>
    <result column="parent_id" property="parentId"/>
  </resultMap>

  <insert id="insert" parameterType="com.project.platform.entity.Category" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO categories
    (name, slug, parent_id)
    VALUES
    (#{name}, #{slug}, #{parentId})
  </insert>

  <update id="update" parameterType="com.project.platform.entity.Category">
    UPDATE categories
    <set>
      <if test="name != null">name = #{name},</if>
      <if test="slug != null">slug = #{slug},</if>
      <if test="parentId != null">parent_id = #{parentId},</if>
    </set>
    WHERE id = #{id}
  </update>

  <delete id="deleteById" parameterType="int">
    DELETE FROM categories WHERE id = #{id}
  </delete>

  <delete id="deleteByIds" parameterType="list">
    DELETE FROM categories WHERE id IN
    <foreach collection="ids" item="id" open="(" separator="," close=")">
      #{id}
    </foreach>
  </delete>

  <select id="selectById" resultMap="CategoryResultMap" parameterType="int">
    SELECT * FROM categories WHERE id = #{id}
  </select>

  <select id="selectBySlug" resultMap="CategoryResultMap" parameterType="string">
    SELECT * FROM categories WHERE slug = #{slug} LIMIT 1
  </select>

  <select id="selectPage" resultMap="CategoryResultMap">
    SELECT * FROM categories
    <where>
      <if test="name != null and name != ''">AND name LIKE CONCAT('%',#{name},'%')</if>
      <if test="slug != null and slug != ''">AND slug = #{slug}</if>
      <if test="parentId != null">AND parent_id = #{parentId}</if>
    </where>
    ORDER BY created_at DESC
    LIMIT #{offset}, #{pageSize}
  </select>

  <select id="count" resultType="int">
    SELECT COUNT(1) FROM categories
    <where>
      <if test="name != null and name != ''">AND name LIKE CONCAT('%',#{name},'%')</if>
      <if test="slug != null and slug != ''">AND slug = #{slug}</if>
      <if test="parentId != null">AND parent_id = #{parentId}</if>
    </where>
  </select>

</mapper>
